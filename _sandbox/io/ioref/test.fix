module Test;

import Minilib.Common.IORef;
import Minilib.Testing.UnitTest;

test_simple: TestCase;
test_simple = (
    make_test("test_simple") $ |_|
    let ioref = *IORef::make(42).lift;
    let ioref2 = ioref;
    assert_equal("eq", 42, *ioref.get.lift);;
    ioref.IORef::set(43).lift;;
    assert_equal("eq", 43, *ioref.get.lift);;
    assert_equal("eq", 43, *ioref2.get.lift);;
    ioref.mod(add(1)).lift;;
    assert_equal("eq", 44, *ioref.get.lift);;
    assert_equal("eq", 44, *ioref2.get.lift);;
    pure()
);

test : IO ();
test = (
    [
        test_simple
    ]
    .run_test_driver
);