module Main;

import Minilib.Crypto.Cert.Pem;
import Minilib.Thread.Time;
import Minilib.Text.Hex;


main: IO ();
main = do {
    //let path = Path::parse("/etc/ssl/certs/DigiCert_Global_Root_CA.pem").as_some;
    let path = Path::parse("/etc/ssl/certs/ca-certificates.crt").as_some;
    let contents = *read_file_string(path);
    let _ =*timeit("parse_pem_entries", |_|
        let res = parse_pem_entries(contents);
        res.map(get_size)
    ).lift;
    let entries = *parse_pem_entries(contents).from_result;
    //if true { pure() };
    entries.to_iter.fold_m(
        (), |_, entry|
        println("label=" + entry.@label + " bytes=" + entry.@bytes.to_string_hex).lift
    )
}.try(eprintln);

