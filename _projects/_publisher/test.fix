module Test;

import Publisher.Verup;
import Minilib.Testing.UnitTest;

test_increment_prerelease: TestCase;
test_increment_prerelease = (
    make_table_test("test_increment_prerelease", 
        [
            ("", ok $ "2"),
            ("-", ok $ "-2"),
            ("-alpha", ok $ "-alpha2"),
            ("-alpha2", ok $ "-alpha3"),
            ("-beta", ok $ "-beta2"),
            ("-beta.100", ok $ "-beta.101"),
        ],
        |(prerelease, expected)|
        let actual = increment_prerelease(prerelease);
        assert_equal("eq", expected, actual)
    )
);

test_increment_version: TestCase;
test_increment_version = (
    make_table_test("test_increment_version", 
        [
            ("", err $ "invalid version format: "),
            ("1.0", err $ "invalid version format: 1.0"),
            ("0.0.0", ok $ "0.0.1"),
            ("1.0.0", ok $ "1.0.1"),
            ("123.456.789", ok $ "123.456.790"),
            ("1.0.0-alpha", ok $ "1.0.0-alpha2"),
            ("1.0.0-alpha5", ok $ "1.0.0-alpha6"),
            ("1.0.0-alpha9+patch1", ok $ "1.0.0-alpha10+patch1"),
            ("1.0.0-alpha9+", err $ "invalid version format: 1.0.0-alpha9+"),
            ("1.0.0-+", err $ "invalid version format: 1.0.0-+"),
        ],
        |(version, expected)|
        let actual = increment_version(version);
        assert_equal("eq", expected, actual)
    )
);

test: IO ();
test = (
    [
        test_increment_prerelease,
        test_increment_version,
    ]
    .run_test_driver
);