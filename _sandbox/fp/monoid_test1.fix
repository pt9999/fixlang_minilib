module Main;

import Minilib.Trait.Monoid;
import Minilib.Math.Types;
import Minilib.Text.StringEx;

import Sandbox.MonoidEx;

test_endo: IO ();
test_endo = (
    println("test_endo");;
    println(Iterator::range(0, 10).map(endo << |i| add(i.to_string + ",")).mconcat.appEndo("!"));;
    println(Iterator::range(0, 10).fold("", |s, i| s + i.to_string + ",") + "!");;
    pure()
);

test_sum: IO ();
test_sum = (
    println("test_sum");;
    println(Iterator::range(0, 10).map(to_sum).map(map(add(1))).mconcat.get.to_string);;
    println(Iterator::range(0, 10).map(add(1)).sum.to_string);;
    pure()
);

product: [a: Mul, a:One] Iterator a -> a;
product = fold(One::one, Mul::mul);

test_product: IO ();
test_product = (
    println("test_product");;
    println(Iterator::range(0, 10).map(to_product).map(map(add(1))).mconcat.get.to_string);;
    println(Iterator::range(0, 10).map(add(1)).product.to_string);;
    pure()
);

test_first: IO ();
test_first = (
    println("test_first");;
    let check = |i| if i % 3 == 2 { some(i) } else { none() };
    println(Iterator::range(0, 10).map(check).map(to_first).mconcat.get.to_string);;
    println(Iterator::range(0, 10).map(check).fold(none(), |opt, i| if opt.is_some { opt } else { i }).to_string);;
    pure()
);

test_last: IO ();
test_last = (
    println("test_last");;
    let check = |i| if i % 3 == 2 { some(i) } else { none() };
    println(Iterator::range(0, 10).map(check).map(to_last).mconcat.get.to_string);;
    println(Iterator::range(0, 10).map(check).fold(none(), |opt, i| if i.is_some { i } else { opt }).to_string);;
    pure()
);

test_max: IO ();
test_max = (
    println("test_max");;
    println(Iterator::range(0, 10).map(to_max >> some).mconcat.as_some.get.to_string);;
    println(Iterator::range(0, 10).fold(I64::minimum, max).to_string);;
    pure()
);

test_min: IO ();
test_min = (
    println("test_min");;
    println(Iterator::range(0, 10).map(to_min >> some).mconcat.as_some.get.to_string);;
    println(Iterator::range(0, 10).fold(I64::maximum, min).to_string);;
    pure()
);

main: IO ();
main = (
    test_endo;;
    test_sum;;
    test_product;;
    test_first;;
    test_last;;
    test_max;;
    test_min;;
    pure()
);

