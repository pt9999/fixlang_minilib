module TypeNameTest;

import Minilib.FFI.TypeName;
import Minilib.Testing.UnitTest;

test_number: TestCase;
test_number = (
    make_test("test_number") $ |_|
    assert_equal("eq", "I8", typeof(42_I8).get_typename);;
    assert_equal("eq", "I16", typeof(42_I16).get_typename);;
    assert_equal("eq", "I32", typeof(42_I32).get_typename);;
    assert_equal("eq", "I64", typeof(42).get_typename);;
    assert_equal("eq", "U8", typeof(42_U8).get_typename);;
    assert_equal("eq", "U16", typeof(42_U16).get_typename);;
    assert_equal("eq", "U32", typeof(42_U32).get_typename);;
    assert_equal("eq", "U64", typeof(42_U64).get_typename);;
    assert_equal("eq", "F32", typeof(42.0_F32).get_typename);;
    assert_equal("eq", "F64", typeof(42.0_F64).get_typename);;
    pure()
);

test_cnumber: TestCase;
test_cnumber = (
    make_test("test_cnumber") $ |_|
    // platform dependent
    assert_equal("eq", "I8", typeof(42.to_CChar).get_typename);;
    assert_equal("eq", "I16", typeof(42.to_CShort).get_typename);;
    assert_equal("eq", "I32", typeof(42.to_CInt).get_typename);;
    assert_equal("eq", "I64", typeof(42.to_CLong).get_typename);;
    assert_equal("eq", "I64", typeof(42.to_CLongLong).get_typename);;
    assert_equal("eq", "U8", typeof(42.to_CUnsignedChar).get_typename);;
    assert_equal("eq", "U16", typeof(42.to_CUnsignedShort).get_typename);;
    assert_equal("eq", "U32", typeof(42.to_CUnsignedInt).get_typename);;
    assert_equal("eq", "U64", typeof(42.to_CUnsignedLong).get_typename);;
    assert_equal("eq", "U64", typeof(42.to_CUnsignedLongLong).get_typename);;
    assert_equal("eq", "U64", typeof(42.to_CSizeT).get_typename);;
    assert_equal("eq", "F32", typeof(42.to_CFloat).get_typename);;
    assert_equal("eq", "F64", typeof(42.to_CDouble).get_typename);;
    pure()
);


test_typelist: TestCase;
test_typelist = (
    make_test("test_typelist") $ |_|
    assert_equal("eq", "(IO I64)", (typeinfo: TypeInfo (IO I64)).get_typename);;
    assert_equal("eq", "(Arrow I64 String)", (typeinfo: TypeInfo (Arrow I64 String)).get_typename);;
    assert_equal("eq", "(Array I64)", (typeinfo: TypeInfo (Array I64)).get_typename);;
    assert_equal("eq", "(Destructor I64)", (typeinfo: TypeInfo (Destructor I64)).get_typename);;
    assert_equal("eq", "(Identity I64)", (typeinfo: TypeInfo (Identity I64)).get_typename);;
    assert_equal("eq", "(Const I64 String)", (typeinfo: TypeInfo (Const I64 String)).get_typename);;
    pure()
);

test_tuple: TestCase;
test_tuple = (
    make_test("test_tuple") $ |_|
    assert_equal("eq", "()", (typeinfo: TypeInfo ()).get_typename);;
    assert_equal("eq", "(Tuple1 I64)", (typeinfo: TypeInfo (Tuple1 I64)).get_typename);;
    assert_equal("eq", "(Tuple2 I64 U64)", (typeinfo: TypeInfo (Tuple2 I64 U64)).get_typename);;
    //assert_equal("eq", "(Tuple3 I64 U64 I32)", (typeinfo: TypeInfo (Tuple3 I64 U64 I32)).get_typename);;
    //assert_equal("eq", "(Tuple4 I64 U64 I32 U32)", (typeinfo: TypeInfo (Tuple4 I64 U64 I32 U32)).get_typename);;
    assert_equal("eq", "(Tuple5 I64 U64 I32 U32 I16)", (typeinfo: TypeInfo (Tuple5 I64 U64 I32 U32 I16)).get_typename);;
    pure()
);

main: IO ();
main = (
    [
        test_number,
        test_cnumber,
        test_typelist,
        test_tuple,
    ].run_test_driver
);