module Main;

import Minilib.Net.Curl;
import Minilib.Text.StringEx;

main : IO ();
main = (
    eval *println("program start");
    do {
        let curl = *Curl::make;
        let boxed: Boxed String = Boxed{ value: "test123" };
        eval *curl.set_boxed_value(1, boxed);
        eval *curl.set_url("http://www.google.co.jp/");
        eval *curl.set_write_callback(|bytes|
            eval *println(">> " + bytes._unsafe_to_string).lift;
            pure $ bytes.get_size
        );
        eval *curl.perform;
        pure()
    }
    .try (|err| eprintln (err))
);
