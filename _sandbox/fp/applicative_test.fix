module Main;

import Minilib.Trait.Applicative;
import Minilib.Testing.UnitTest;

test_array: TestCase;
test_array = (
    make_test("test_array") $ |_|
    let add: I8 -> I32 -> I64 = |x,y| x.to_I64 + y.to_I64;
    let fs = [add(1_I8), add(2_I8)];
    let ys = [10_I32, 20_I32];
    let zs: Array I64 = app_a(fs, ys);
    println(zs.map(to_string).to_iter.join(",")).lift;;
    assert_equal("eq", [11, 21, 12, 22], zs);;
    let xs = [1_I8, 2_I8];
    let zs: Array I64 = lift_a2(add, xs, ys);
    println(zs.map(to_string).to_iter.join(",")).lift;;
    assert_equal("eq", [11, 21, 12, 22], zs);;
    pure()
);

test_iter: TestCase;
test_iter = (
    make_test("test_iter") $ |_|
    let add: I8 -> I32 -> I64 = |x,y| x.to_I64 + y.to_I64;
    let fs = [add(1_I8), add(2_I8)].to_iter.to_dyn;
    let ys = [10_I32, 20_I32].to_iter.to_dyn;
    let zs: DynIterator I64 = app_a(fs, ys);
    println(zs.Iterator::map(to_string).join(",")).lift;;
    assert_equal("eq", [11, 21, 12, 22], zs.to_array);;
    let xs = [1_I8, 2_I8].to_iter.to_dyn;
    let zs: DynIterator I64 = lift_a2(add, xs, ys);
    println(zs.Iterator::map(to_string).join(",")).lift;;
    assert_equal("eq", [11, 21, 12, 22], zs.to_array);;
    pure()
);

// TODO: add tests

main: IO ();
main = (
    [
        test_array,
        test_iter,
    ]
    .run_test_driver
);
