module Main;

import AsyncTask;

task_job: I64 -> IO I64;
task_job = |i| (
    pure();;
    println("task start: " + i.to_string);;
    FFI_CALL_IO[() sleep(CInt), 1.to_CInt];;    // 1秒間スリープする
    println("task end: " + i.to_string);;
    pure $ i * 10
);

main: IO ();
main = (
    // 10個のタスクを並列実行する
    let tasks = *range(0, 10).map(|i| AsyncIOTask::make(task_job(i))).collect_m;
    println("created tasks");;
    let results = *tasks.to_iter.map(|task| task.get).collect_m;
    println("results=" + results.to_string)
);