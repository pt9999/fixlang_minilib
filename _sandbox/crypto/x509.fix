// X.509 Certificate module
//
// RFC 5280 - Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile
// https://tex2e.github.io/rfc-translater/html/rfc5280.html
module Minilib.Crypto.X509;

import Minilib.Crypto.Asn1.Der;
import Minilib.Encoding.Binary;
import Minilib.Monad.State;
import Minilib.Monad.Error;
import Minilib.Monad.Trans;
import Minilib.Text.StringEx;
import Minilib.Text.Hex;

// 4.1. Basic Certificate Fields

type Certificate = unbox struct {
    tbs_certificate: TBSCertificate,
    signature_algorithm:   AlgorithmIdentifier,
    signature_value: BitString,
};

type TBSCertificate = unbox struct {
    version: Version,
    serialNumber: CertificateSerialNumber,
    signature: AlgorithmIdentifier,
    issuer: Name,
    validity: Validity,
    subject: Name,
    subjectPublicKeyInfo: SubjectPublicKeyInfo,
    issuerUniqueID: Option UniqueIdentifier,
    subjectUniqueID: Option UniqueIdentifier,
    extensions: Option Extensions,
};

type Version = Asn1::Integer; // v1(0), v2(1), v3(2)

type CertificateSerialNumber = BigInt;

type Validity = unbox struct {
    notBefore: Time,
    notAfter: Time,
};

type Time = String;

type UniqueIdentifier = BitString;

