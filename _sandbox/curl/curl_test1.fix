module Main;

import Minilib.Net.Curl;
import Minilib.Text.StringEx;

main : IO ();
main = (
    eval *println("program start");
    do {
        let curl = *Curl::make;
        eval *curl.set_url("http://www.google.co.jp/");
        let output_path = Path::parse("tmp.output.txt").as_some;
        with_file(output_path, "w", |output_handle|
            eval *curl.set_write_callback(|bytes|
                eval *write_bytes(output_handle, bytes);
                eval *println("... write_callback: wrote " + bytes.get_size.to_string + " bytes").lift;
                pure $ bytes.get_size
            );
            eval *curl.perform;
            pure()
        )
    }
    .try (|err| eprintln (err))
);
