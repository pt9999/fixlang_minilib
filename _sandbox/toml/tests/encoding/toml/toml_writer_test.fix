module TomlWriterTest;

import Minilib.Encoding.Toml;
import Minilib.Encoding.Toml.TomlWriter;
import Minilib.Text.StringEx;
import Minilib.Testing.UnitTest;

test_simple: TestCase;
test_simple = (
    make_test("test_simple") $ |_|
    let toml = Toml::empty;
    let toml = toml["key2"].tset("value2");
    let toml = toml["key1"].tset("value1");
    let expected = (
        "key2 = \"value2\"\n"
        + "key1 = \"value1\"\n"
    );
    let actual = "".toml_write(toml);
    assert_equal("eq", expected, actual)
);

test_table: TestCase;
test_table = (
    make_test("test_table") $ |_|
    let toml = Toml::empty;
    let toml = toml["table2"]["key21"].tset("value21");
    let toml = toml["table1"]["key11"].tset("value11");
    let toml = toml["key2"].tset("value2");
    let toml = toml["key1"].tset("value1");
    let expected = (
        "key2 = \"value2\"\n"
        + "key1 = \"value1\"\n"
        + "[table2]\n"
        + "key21 = \"value21\"\n"
        + "[table1]\n"
        + "key11 = \"value11\"\n"
    );
    let actual = "".toml_write(toml);
    assert_equal("eq", expected, actual)
);

main: IO ();
main = (
    [
        test_simple,
        test_table,
    ]
    .run_test_driver
);
