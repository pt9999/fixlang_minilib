module Main;
type Obj = unbox struct {
    arr: Array I64,
    f: I64 -> I64,
};
execute: Obj -> Obj = |obj| (
    let f = obj.@f;           // ローカル変数に格納する (obj の参照カウンタを増やさないため)
    obj.mod_arr(|arr|
        arr.assert_unique(|_| "arr")   // 最適化するとここで abort する
        .push_back(f(4))
    )
);
main: IO () = (
    let obj: Obj = Obj { arr: [1, 2, 3], f: add(10) };
    let obj = obj.execute;
    println(obj.@arr.to_string)
);
