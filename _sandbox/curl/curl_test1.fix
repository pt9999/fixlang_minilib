module Main;

import Minilib.Net.Curl;

type Value = unbox struct {
    i64: I64,
    str: String,
};

do_set_value1: Curl -> IOFail ();
do_set_value1 = |curl| (
    let value = Value {
        i64: 123,
        str: "abc" + "def"
    };
    let boxed = Boxed { value: value };
    curl.set_fix_value1(boxed)
);

do_get_value1: Curl -> IOFail ();
do_get_value1 = |curl| (
    let boxed: Boxed Value = *curl.get_fix_value1;
    let value = boxed.@value;
    println("(i64,str)=" + (value.@i64, value.@str).to_string).lift
);


main : IO ();
main = (
    eval *println("program start");
    do {
        let curl = *Curl::make;
        eval *curl.do_set_value1;
        eval *curl.do_get_value1;
        eval *curl.set_url("http://www.google.co.jp/");
        eval *curl.perform;
        pure()
    }
    .try (|err| eprintln (err))
);
